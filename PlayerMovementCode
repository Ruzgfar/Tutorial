using UnityEngine;

public class PlayerMovement : MonoBehaviour
{
    // âœ¨ GeliÅŸtiricinin HÄ±z, ZÄ±plama vb. DeÄŸerleri AyarlayabileceÄŸi Alan
    [Header("Hareket AyarlarÄ±")]
    public float movementSpeed = 5f; // Karakterin yÃ¼rÃ¼me hÄ±zÄ±
    public float sprintSpeed = 10f;  // Karakterin depar hÄ±zÄ±
    public float jumpForce = 8f;     // ZÄ±plama kuvveti (YÃ¼ksekliÄŸi)
    public float gravity = 20f;      // Karakteri aÅŸaÄŸÄ± Ã§eken yerÃ§ekimi kuvveti

    // ğŸ§± Gerekli BileÅŸen ReferanslarÄ±
    private CharacterController characterController;
    private Vector3 moveDirection; // Karakterin hareket yÃ¶nÃ¼nÃ¼ tutan vektÃ¶r

    void Start()
    {
        // 1. KarakterController bileÅŸenini baÅŸlatÄ±rken al
        characterController = GetComponent<CharacterController>();

        // GÃ¼venlik kontrolÃ¼: BileÅŸen mevcut mu?
        if (characterController == null)
        {
            Debug.LogError("CharacterController bulunamadÄ±! LÃ¼tfen Player GameObject'ine ekleyin.");
            enabled = false; // Script'i kapat
        }
    }

    void Update()
    {
        // Karakter Controller ile hareketler Update iÃ§inde yapÄ±lÄ±r.
        HandleMovement();
        HandleGravityAndJump();
    }

    private void HandleMovement()
    {
        // 1. Girdi AlÄ±mÄ±: Yatay ve Dikey eksen girdilerini al
        float horizontalInput = Input.GetAxis("Horizontal"); // A/D veya Sol/SaÄŸ
        float verticalInput = Input.GetAxis("Vertical");   // W/S veya YukarÄ±/AÅŸaÄŸÄ±

        // 2. YÃ¶n Hesaplama: Girdileri dÃ¼nya uzayÄ±nda (World Space) bir yÃ¶ne Ã§evir
        Vector3 forward = transform.forward; // Karakterin baktÄ±ÄŸÄ± yÃ¶n (Z ekseni)
        Vector3 right = transform.right;   // Karakterin saÄŸa baktÄ±ÄŸÄ± yÃ¶n (X ekseni)

        // Sadece XZ dÃ¼zleminde (Yerde) hareket etmesi iÃ§in Y ekseni 0 yapÄ±lÄ±r
        moveDirection.x = (forward.x * verticalInput) + (right.x * horizontalInput);
        moveDirection.z = (forward.z * verticalInput) + (right.z * horizontalInput);
        
        // VektÃ¶rÃ¼n bÃ¼yÃ¼klÃ¼ÄŸÃ¼nÃ¼ (Magnitude) 1'de tut, bÃ¶ylece Ã§apraz hareketler hÄ±zlÄ± olmaz
        if (moveDirection.x != 0 || moveDirection.z != 0)
        {
            moveDirection.Normalize();
        }

        // 3. HÄ±z Uygulama: Harekete hÄ±zÄ± uygula
        float currentSpeed = movementSpeed;
        
        // Depar kontrolÃ¼: Sol Shift tuÅŸuna basÄ±lÄ±yorsa depar hÄ±zÄ±nÄ± kullan
        if (Input.GetKey(KeyCode.LeftShift))
        {
            currentSpeed = sprintSpeed;
        }

        moveDirection.x *= currentSpeed;
        moveDirection.z *= currentSpeed;
    }

    private void HandleGravityAndJump()
    {
        // 1. Zemin KontrolÃ¼: Karakter yerde mi? (CharacterController'Ä±n yerleÅŸik Ã¶zelliÄŸi)
        if (characterController.isGrounded)
        {
            // Yerdeyken yerÃ§ekimini sÄ±fÄ±rla (karakterin aÅŸaÄŸÄ± inmesini Ã¶nler)
            // Ancak hafif bir negatif deÄŸer tutmak, zeminle temasÄ±n kaybolmasÄ±nÄ± Ã¶nler
            moveDirection.y = -0.5f; 

            // 2. ZÄ±plama: BoÅŸluk tuÅŸuna basÄ±ldÄ±ysa
            if (Input.GetButtonDown("Jump")) // Unity Input Manager'daki "Jump" (VarsayÄ±lan: Space)
            {
                moveDirection.y = jumpForce; // Y eksenine zÄ±plama kuvveti uygula
            }
        }
        else
        {
            // Yerde deÄŸilse: YerÃ§ekimi kuvvetini uygulamaya devam et
            // moveDirection.y'yi zamanla azalt, bÃ¶ylece karakter dÃ¼ÅŸer
            moveDirection.y -= gravity * Time.deltaTime;
        }

        // 3. Son Hareket: TÃ¼m hesaplamalarÄ± CharacterController'a uygula
        // Time.deltaTime, cihaz hÄ±zÄ±na bakmaksÄ±zÄ±n saniyede tutarlÄ± hareket saÄŸlar.
        characterController.Move(moveDirection * Time.deltaTime);
    }
}
